{"version":3,"sources":["assets\\Script\\create_enemy.js"],"names":["aircraftLoading","quantity","chance","componentName","grade","cc","Class","Component","properties","aircraft","type","Prefab","tooltip","object_pool","require","taktTime","onLoad","createEnemy","plant","background","find","schedule","aircraftAdd","prefab","currentElement","enemy","name","parentNode","node","parent","x","randomPosition","y","height","takeOff","random","Math","b","width","number","parseInt","max","gap","abs","action","moveTo","ySpeed","finished","callFunc","recyclePool","myAction","sequence","show","runAction","forEach","element","index","initPool","initCount","num","fistChance","currentNumber","i"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\nconst aircraftLoading = [{\r\n    quantity: 10,\r\n    chance: 65,\r\n    componentName: 'enemy_01',\r\n    grade: 1\r\n}, {\r\n    quantity: 5,\r\n    chance: 25.2,\r\n    componentName: 'enemy_01',\r\n    grade: 3\r\n}, {\r\n    quantity: 2,\r\n    chance: 9.8,\r\n    componentName: 'enemy_01',\r\n    grade: 5\r\n}]\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        aircraft: {\r\n            default: [],\r\n            type: cc.Prefab,\r\n            tooltip: '飞机'\r\n        },\r\n        object_pool: {\r\n            default: null,\r\n            type: require('object_pool'),\r\n        },\r\n        taktTime: {\r\n            default: 2000\r\n        }\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        this.createEnemy()\r\n        this.plant()        \r\n    },\r\n\r\n    plant () { // 飞机工厂\r\n        let background = cc.find('Canvas/background')\r\n        this.schedule(function() {\r\n            let {prefab, currentElement} = this.aircraftAdd()\r\n            if(prefab){\r\n                let enemy = this.object_pool.createEnemy({\r\n                    name: prefab.name,\r\n                    parentNode: this.node.parent,\r\n                    componentName: 'enemy_01'\r\n                })\r\n                let node = enemy.node\r\n                node.quantity = currentElement.quantity\r\n                node.chance = currentElement.chance\r\n                node.grade = currentElement.grade\r\n                node.x = this.randomPosition(background, node)\r\n                node.y = (background.height/2)  + (node.height * 0.5)\r\n                this.takeOff(node, background)\r\n                \r\n            }\r\n        }, this.taktTime / 1000)\r\n    },\r\n\r\n    randomPosition (parent, node) { // 创建敌人的随机位置\r\n        let random = Math.random()\r\n        let b = parent.width / 2 // 获得屏幕一半\r\n        let number = -parseInt( b - (parent.width * random) ) // 用一半减去百分比 得到整就是少 负值就是多 所以取反\r\n        \r\n        let max = b - (node.width / 2) // 得到不超过屏幕最大值\r\n        let gap = max - Math.abs( number ) // 和最大值的间隙\r\n        if(gap < 0) {\r\n            number > 0 ? number = max : number = -max // 让飞机始终不能超过最大\r\n        }\r\n        return number\r\n    },\r\n\r\n    takeOff(enemy, parent) { // 启动飞机\r\n        const object_pool = this.object_pool\r\n        // console.log(enemy.ySpeed, enemy.x);\r\n        var action = cc.moveTo(enemy.ySpeed, enemy.x, -((parent.height/2) + (enemy.height * 0.5)));\r\n        var finished = cc.callFunc(function () {\r\n            object_pool.recyclePool({\r\n                node: enemy,\r\n                name: enemy.name\r\n            })\r\n        }, this);\r\n        var myAction = cc.sequence(cc.show(),action, finished);\r\n        enemy.runAction(myAction);\r\n    },\r\n\r\n    createEnemy() { // 生成敌人\r\n        let aircraft = this.aircraft\r\n        aircraft.forEach((element, index) => {\r\n            if (!element) return\r\n            let name = element.name\r\n            this.object_pool.initPool({\r\n                initCount: aircraftLoading[index].quantity,\r\n                name,\r\n                prefab: element\r\n            })\r\n        })\r\n    },\r\n\r\n    aircraftAdd() { // 飞机添加\r\n        \r\n        let num = Math.random()\r\n        let index\r\n        let fistChance = 0\r\n        let currentNumber = 0\r\n        let currentElement\r\n        aircraftLoading.forEach((element, i) => {\r\n            let chance = element.chance / 100\r\n            currentNumber += chance\r\n            if(num > fistChance &&  num <= currentNumber ) {\r\n                index = i\r\n                currentElement = element\r\n            }\r\n            fistChance = currentNumber\r\n        })\r\n        let prefab = this.aircraft[index]\r\n        return {\r\n            prefab,\r\n            currentElement\r\n        }\r\n    }\r\n    // start () {\r\n\r\n    // },\r\n\r\n    // update (dt) {},\r\n});"]}