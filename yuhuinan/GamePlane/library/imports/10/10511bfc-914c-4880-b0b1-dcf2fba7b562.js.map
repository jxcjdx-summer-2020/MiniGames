{"version":3,"sources":["assets\\Script\\hero.js"],"names":["cc","Class","Component","properties","object_pool","type","require","fireRate","tooltip","harm","bulletPrefab","Prefab","bulletName","onLoad","manager","director","getCollisionManager","enabled","node","componentName","onDrag","initBullet","fire","schedule","create","name","parentNode","parent","createEnemy","setCurrentPosition","init","initCount","prefab","initPool","getLimit","on","dragMove","winSize","minX","width","maxX","minY","height","maxY","event","info","convertToNodeSpaceAR","getLocation","x","y","setPosition","ruin","off","anim","getComponent","Animation","animName","runAction","hide","setCurrentTime","destroy","isHit","loadScene","play","onCollisionEnter","other","console","log","group"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        object_pool: {\r\n            default: null,\r\n            type: require('object_pool'),\r\n        },\r\n        fireRate: {\r\n            default: 300,\r\n            tooltip: '射速'\r\n        },\r\n        harm: {\r\n            default: 5\r\n        },\r\n        bulletPrefab: {\r\n            default: null,\r\n            type: cc.Prefab,\r\n            tooltip: '初始创建子弹',\r\n        },\r\n        bulletName: {\r\n            default: 'bullet',\r\n            tooltip: '子弹名称'\r\n        }\r\n    },\r\n\r\n    onLoad () {\r\n        var manager = cc.director.getCollisionManager();\r\n        manager.enabled = true\r\n        this.node.componentName = 'hero'\r\n        this.onDrag()\r\n        this.initBullet()\r\n        this.fire()\r\n    },\r\n    \r\n    fire() {\r\n        this.schedule(function() {\r\n            let create = {\r\n                name: this.bulletName,\r\n                parentNode: this.node.parent\r\n            }\r\n            this.object_pool.createEnemy(create).setCurrentPosition(this.node).fire(this.node)\r\n        }, this.fireRate / 1000);\r\n    },\r\n\r\n    initBullet() {\r\n        let init = {name: this.bulletName, initCount: 10, prefab: this.bulletPrefab}\r\n        this.object_pool.initPool(init)\r\n    },\r\n\r\n    onDrag() { // 主角可以进行拖动\r\n        this.getLimit() // 获取移动结界\r\n        this.node.on('touchmove', this.dragMove, this);\r\n    },\r\n    getLimit() {\r\n        const parent = cc.winSize\r\n        this.minX = -parent.width/2+this.node.width/2;\r\n        this.maxX = -this.minX;\r\n        this.minY = -parent.height/2+this.node.height/2;\r\n        this.maxY = -this.minY;\r\n    },\r\n    dragMove: function(event){ \r\n        // convertToNodeSpaceAR // 将一个点转换到节点 (局部) 空间坐标系，这个坐标系以锚点为原点。\r\n        const parent = this.node.parent\r\n        var info = parent.convertToNodeSpaceAR(event.getLocation()) // https://docs.cocos.com/creator/api/zh/classes/Event.EventMouse.html#getlocation\r\n        let {\r\n            x,\r\n            y\r\n        } = info\r\n        //飞机不移出屏幕 \r\n        if (x< this.minX){\r\n            x = this.minX;\r\n        }\r\n        if (x>this.maxX){\r\n            x = this.maxX;\r\n        }\r\n        if (y< this.minY){\r\n            y = this.minY;\r\n        }\r\n        if (y> this.maxY){\r\n            y = this.maxY;\r\n        }\r\n        this.node.setPosition(x,y) // https://docs.cocos.com/creator/api/zh/classes/Node.html#setposition\r\n    },\r\n\r\n    ruin() {\r\n        this.node.off('touchmove')\r\n        let name = this.node.name\r\n        let anim = this.getComponent(cc.Animation);\r\n        let animName = `${name}_ruin`\r\n        anim.on('finished',()=>{\r\n            anim.off('finished')\r\n            anim.node.runAction(cc.hide())\r\n            anim.setCurrentTime(0,animName)\r\n            this.node.destroy()\r\n            this.isHit = false\r\n            cc.director.loadScene ('game_over',function(){\r\n               \r\n            }) \r\n        },anim);\r\n        anim.play(animName)\r\n    },\r\n\r\n    onCollisionEnter: function (other) { // 碰撞结束\r\n        if(this.isHit) return\r\n        this.isHit = true\r\n        // let component = other.getComponent(other.node.componentName)\r\n        console.log(other.node.group);\r\n        \r\n        switch (other.node.group) {\r\n            case 'enemy':\r\n                this.ruin()\r\n                break;\r\n            case 'porp':\r\n                console.log(other.node); \r\n                this.isHit = false\r\n                break;\r\n            default:\r\n                this.isHit = false\r\n                break;\r\n        }\r\n        // console.log(component, other);\r\n    }\r\n\r\n    // update (dt) {},\r\n});\r\n"]}